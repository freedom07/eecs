이 장에서는 보조 저장 매체인 하드 디스크 드라이브와 비휘발성 메모리 장치상의 파일 저장과 접근을 둘러싸고 있는 이슈들에 대해 논의한다.

# 파일 시스템 구조
입/출력 제어
- 장치 드라이버 루틴, 인터럽트 핸들러로 이루어져 있어서 메모리와 디스크 시스템 간의 정보 전송을 담당한다.

기본 파일시스템
- 적절한 장치 드라이버에게 저장장치상의 블록을 읽고 쓰도록 일반적인 명령을 내린다.
- I/O 요청 스케줄링을 고려한다.
- 다양한 파일 시스템, 디렉토리 및 데이터 블록을 저장하는 메모리 버퍼와 캐시를 관리한다.

파일-구성 모듈
- 파일과 상응하는 논리 블록을 알고 있다.
- 어느 디스크 공간이 비어 있는지를 파악하는 가용 공간 관리자도 포함한다.

논리 파일 시스템
- 메타데이터 정보를 관리한다. 메타데이터는 파일의 내용 자체인 데이터를 제외한 모든 파일 시스템 구조를 말한다.
- 파일 구조는 파일 제어 블록(file control block, FCB)를 통해 유지되는데 이는 소유, 허가, 파일 내용의 위치를 포함하여 파일에 관한 정보를 가지고 있다.

# 파일 시스템 구현
운영체제는 파일 콘텐츠 접근을 요구하는 프로세스를 위해 open(), close() 시스템 콜을 구현한다.

사용법

# 디렉토리 구현
디렉토리 공간을 어떻게 할당하고 관리하는지가 파일 시스템의 효율, 성능, 신뢰성에 큰 영향을 미친다. 

선형 리스트
- 디렉토리를 구현하는 가장 간단한 방법으로 파일 이름과 데이터 블록에 대한 포인터들의 선형 리스트를 디렉토리에 사용한다.
- 실행 시간이 길다.

해시 테이블
- 위 선형 리스트에 디렉토리 항목이 저장되고 해시 자료구조도 함께 사용한다. 파일 이름을 제시하면 해시로부터 값을 얻어서 그것을 포인터로 활용하여 리스트를 직접 접근할 수 있다.

# 할당 방법
거의 모든 경우에 한 저장장치에 여러 파일이 저장된다. 주요 문제는 파일들을 어떻게 저장장치 공간에 배치해야 디스크 공간을 효율적으로 사용할 수 있고 파일들을 빨리 접근할 수 있을까

연속 할당
- 각 파일이 저장장치 내에서 연속적인 공간을 차지하도록 요구한다.
- 하지만 새로운 파일을 위한 가용 공간을 찾는 일이 어렵다. 이는 뒤에 가용 공간 관리 방법에서 해결 방법을 제시한다.

연결 할당
- 파일은 저장장치 블록의 연결 리스트 형태로 저장되고, 이 블록들은 장치 내에 흩어져 저장될 수 있다. 디렉토리는 파일의 첫 번째와 마지막 블록에 대한 포인터를 가지고 있다.
- 연속 할당의 외부 단편화 문제와 파일 크기 선언 문제를 해결했다.
- 하지만 순차적 접근 파일에만 효과적으로 사용될 수 있고 직접 접근 방식에는 매우 비효율적이다.
- 또 다른 단점은 포인터들을 위한 공간이 필요하다는 것이다.
- 파일 할당 테이블(file allocation table, FAT)

색인 할당
- 연결 할당은 FAT 가 없으면 직접 접근 방식을 지원할 수 없다. 색인 할당은 모든 포인터들을 하나의 장소, 즉 색인 블록으로 관리함으로써 이 문제를 해결한다. (페이징 기법과 유사하다)
- 연결 기법
- 다중 수준 색인
- 결합 기법

성능

# 가용 공간의 관리
저장 장치의 공간은 제한되어있기 때문에, 삭제된 파일들이 차지하던 공간을 새로운 파일들을 위해 다시 재사용해야한다. 시스템은 이러한 가용 공간을 리스트로 유지하고 관리한다. 이 리스트에 장치의 모든 가용 블록들을 등록한다. 새로운 파일을 만들려면 이 가용 공간 리스트를 탐색하여 새로운 파일을 위한 공간을 할당 받아야한다.

비트 벡터

연결 리스트

그룹핑

계수

공간맵

사용하지 않는 블록 트림

# 효율과 성능
위에서 살펴본 다양한 블록 할당과 디렉토리 관리기법들이 저장 장치의 성능과 효율적인 사용에 어떤 영향을 미치는지 살펴본다. 디스크는 컴퓨터 시스템에서 가장 속도가 느리기 때문에 시스템 성능 면에서 병목의 주요 원인이 되는데, 디스크의 성능과 효율을 높이기 위해서 어떻게 해야할까 ?

효율

성능
- 버퍼 캐시용
- 페이지 캐시

# 복구
파일과 디렉토리는 때에 따라서는 메인 메모리와 저장장치 볼륨 두 곳에 존재하게 되기 때문에 일관성을 가져야하고, 자료를 잃어버리지 않도록 보장해야한다. 디스크 상의 디렉토리 구조, 가용 블록 포인터, 가용 FCB 포인터와 같은 파일 시스템 자료구조는 시스템이 고장났을 때 일관성이 없어질 수 있다.

일관성 검사

로그 구조 파일 시스템

다른 해결 방안들

백업과 복구